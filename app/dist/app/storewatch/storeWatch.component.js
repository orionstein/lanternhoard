System.register(["angular2/core","angular2/router","./store.service"],function(e,t){"use strict";var o,s,r,n,i=(t&&t.id,this&&this.__decorate||function(e,t,o,s){var r,n=arguments.length,i=n<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,o):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,o,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(i=(n<3?r(i):n>3?r(t,o,i):r(t,o))||i);return n>3&&i&&Object.defineProperty(t,o,i),i}),a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};return{setters:[function(e){o=e},function(e){s=e},function(e){r=e}],execute:function(){n=function(){function e(e,t){this._router=e,this._store=t}return e.prototype.ngOnDestroy=function(){delete this.elm,this.pollStore=!1},e.prototype.ngOnInit=function(){var e=this,e=this;this.modals={successModal:!1,errorModal:!1},this.pollStore=!0,this.elm=Elm.StoreWatchElm.embed(document.getElementById("store-watch-elm-embed")),this._store.getStoreEntry().subscribe(function(t){e.hasMore=t.hasMore,e.storeEntries=t.items,e._store.firstItem=_.head(e.storeEntries),e._store.lastItem=_.last(e.storeEntries),e._store.lastItem.lastItem=!0,setTimeout(function(){e.elm.ports.entries.send(e.storeEntries)},0),e._store.startPolling().takeWhile(function(t){return!!e.pollStore}).subscribe(function(t){t&&(e.storeEntries=t.items.concat(e.storeEntries),e._store.firstItem=_.head(e.storeEntries),e.elm.ports.entries.send(e.storeEntries))})}),this.elm.ports.action.subscribe(function(t){var o=JSON.parse(t);ga("send",{hitType:"event",eventCategory:"Subscription",eventAction:"SubscribeMobile",eventLabel:"StoreWatch"}),""!==o.number&&e._store.submitMobile(o.number).subscribe(function(t){e.modals.successModal=!0,ga("send",{hitType:"event",eventCategory:"Subscription",eventAction:"SubscribeMobileSuccess",eventLabel:"StoreWatch"})},function(t){e.modals.errorModal=!0,ga("send",{hitType:"event",eventCategory:"Subscription",eventAction:"SubscribeMobileFailure",eventLabel:"StoreWatch"})})}),ga("send","pageview",location.pathname,{title:"StoreWatch"})},e.prototype.closeModal=function(e){this.modals[e]=!1},e.prototype.closeModals=function(){this.modals.successModal=!1,this.modals.errorModal=!1},e.prototype.updateFeed=function(e){this.elm.ports.entries.send(e)},e.prototype.loadMore=function(){var e=this;this._store.loadMoreEntries().subscribe(function(t){e.hasMore=t.hasMore,e._store.lastItem.lastItem=!1,e.storeEntries=e.storeEntries.concat(t.items),e._store.firstItem=_.head(e.storeEntries),e._store.lastItem=_.last(e.storeEntries),e._store.lastItem.lastItem=!0,e.elm.ports.entries.send(e.storeEntries)})},e=i([o.Component({selector:"storewatch",templateUrl:"app/storewatch/storeWatch.component.html",styleUrls:["app/storewatch/storeWatch.component.css"],providers:[r.StoreService]}),a("design:paramtypes",[s.Router,r.StoreService])],e)}(),e("StoreWatchComponent",n)}}});